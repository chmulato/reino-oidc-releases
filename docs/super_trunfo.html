<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reino OIDC ‚Äî Edi√ß√£o Super Trunfo | Proteja seu Reino</title>
    <meta name="description" content="Jogo de cartas Super Trunfo do Reino da Identidade Federada. Seguran√ßa, Complexidade, Escalabilidade e Privacidade (LGPD). Cara Core Inform√°tica.">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/super-trunfo.css">
    <link rel="stylesheet" href="assets/css/sucesso-ativacao.css">
</head>
<body class="super-trunfo">
    <!-- Navega√ß√£o do Reino (alinhada a todas as telas) -->
    <nav class="navbar navbar-expand-lg navbar-dark reino-nav-super-trunfo">
        <div class="container">
            <a class="navbar-brand" href="index.html">üè∞ Reino OIDC</a>
            <span class="navbar-text ms-auto me-3 d-none d-md-inline">
                <span class="text-white small" title="Cara Core Inform√°tica">Cara Core Inform√°tica</span>
            </span>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">üè† In√≠cio</a></li>
                    <li class="nav-item"><a class="nav-link" href="personagens.html">üë• Personagens</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">üìñ Hist√≥ria</a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="historia_p1.html">Parte I - A Era Sombria</a></li>
                            <li><a class="dropdown-item" href="historia_p2.html">Parte II - A Chegada do OIDC</a></li>
                            <li><a class="dropdown-item" href="historia_p3.html">Parte III - A Nova Era</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="conclusao.html">Conclus√£o</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="mundo_do_conhecimento.html">üåü Conhecimento</a></li>
                    <li class="nav-item"><a class="nav-link" href="caminho_feliz.html">‚ú® Caminho Feliz</a></li>
                    <li class="nav-item"><a class="nav-link active" href="super_trunfo.html">üÉè Super Trunfo</a></li>
                    <li class="nav-item"><a class="nav-link" href="aprendiz.html">üéì Academia</a></li>
                    <li class="nav-item"><a class="nav-link" href="glossario.html">üìö Gloss√°rio</a></li>
                    <li class="nav-item"><a class="nav-link" href="mapas.html">üó∫Ô∏è Mapas</a></li>
                    <li class="nav-item"><a class="nav-link" href="mapa_evolucao.html">üìú Evolu√ß√£o</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- T√≠tulo e narrativa do Reino -->
    <header class="reino-header-super-trunfo">
        <div class="container">
            <h1 class="reino-title">Reino da Identidade Federada ‚Äî Super Trunfo</h1>
            <p class="reino-subtitle">Jogue com os personagens do Reino. Proteja seu Reino ¬∑ Governe suas Identidades.</p>
        </div>
    </header>

    <!-- Narrativa de empoderamento (linha do Reino) -->
    <section class="empowerment-banner container mt-3">
        <p><strong>Proteja seu Reino.</strong> Escolha o atributo que defende sua identidade. <strong>Governe suas Identidades.</strong> Cada carta √© um <strong>personagem do Reino</strong> ‚Äî Lady OAuth, Lord OIDC, Pixie PKCE e os demais. <strong>Torne-se a Arquiteta do Acesso.</strong></p>
    </section>

    <!-- Linha do Tempo: brilha conforme a hist√≥ria (p1 ‚Üí p2 ‚Üí p3) -->
    <div class="container">
        <div id="reino-timeline" role="navigation" aria-label="Progress√£o das Eras da Hist√≥ria"></div>
    </div>

    <main class="mesa-container container">
        <!-- Personagens do Reino ‚Äî escolha do baralho -->
        <section class="deck-section">
            <div class="mesa-title">Personagens do Reino ‚Äî Escolha o Baralho</div>
            <div class="deck-tabs">
                <button type="button" class="deck-tab active" id="deck-1" data-deck="deck1">1. Personagens do Reino</button>
                <button type="button" class="deck-tab" id="deck-2" data-deck="deck2">2. Alian√ßa Federada</button>
                <button type="button" class="deck-tab locked" id="deck-3" data-deck="deck3">3. Minera√ß√£o de Chaves I</button>
                <button type="button" class="deck-tab locked" id="deck-4" data-deck="deck4">4. Minera√ß√£o de Chaves II</button>
                <button type="button" class="deck-tab locked" id="deck-5" data-deck="deck5">5. Minera√ß√£o de Chaves III</button>
            </div>
            <p class="small mb-0 deck-attr-legend">Atributos das cartas: <strong>Fortifica√ß√£o</strong> ¬∑ <strong>Nobreza</strong> (menor √© melhor) ¬∑ <strong>Linhagem</strong> ¬∑ <strong>Sigilo</strong>. <a href="personagens.html" class="link-personagens">Conhe√ßa os personagens do Reino</a>.</p>
        </section>

        <!-- Era 3 = Premium: Chegar ao Presente (Devia + Seraph Resource) -->
        <div class="upgrade-elite-box era-3-cta" id="era-3-premium-cta">
            <h3>üëë Chegar ao Presente ‚Äî Era 3 (O Presente Soberano)</h3>
            <p>Para desbloquear <strong>Devia</strong> (Integradora Suprema), <strong>Seraph Resource</strong> (Guardi√£o das APIs) e <strong>Ace Token</strong>, e dominar as APIs modernas, √© necess√°rio o <strong>Selo de Soberania da Cara-Core</strong> (R$ 29,90 ‚Äî valor √∫nico).</p>
            <ul class="benefits">
                <li>Devia: a programadora do futuro ‚Äî √∫nica que usa o poder de todos os personagens</li>
                <li>Seraph Resource: valida√ß√£o de tokens e prote√ß√£o das APIs</li>
                <li>Acesso atrelado ao seu dispositivo (Hardware ID)</li>
            </ul>
            <button type="button" class="btn-upgrade" id="btn-upgrade-trono">Selo de Soberania ‚Äî R$ 29,90 (Pergaminho de Selagem)</button>
        </div>

        <!-- Upgrade ‚Äî Minera√ß√£o de Chaves (monetiza√ß√£o Cara-Core) -->
        <div class="upgrade-elite-box">
            <h3>üîê M√≥dulo de elite: Minera√ß√£o de Chaves</h3>
            <p>O upgrade de <strong>R$ 29,90</strong> (valor √∫nico) desbloqueia o deck <strong>Minera√ß√£o de Chaves</strong>: <strong>Criptografia de Curva El√≠ptica</strong> e <strong>Selo de Identidade Federada</strong>. Mesma l√≥gica de licenciamento: PIX para CNPJ <span id="display-cnpj">23.969.028/0001-37</span> vinculado ao Hardware ID da jogadora.</p>
            <ul class="benefits">
                <li>Criptografia de Curva El√≠ptica</li>
                <li>Selo de Identidade Federada</li>
                <li>Acesso atrelado ao seu dispositivo (Hardware ID)</li>
            </ul>
            <button type="button" class="btn-upgrade" id="btn-upgrade-trono-secondary">Upgrade ‚Äî R$ 29,90 (Pergaminho de Selagem)</button>
        </div>

        <!-- Selo de Qualidade Pawlowsky -->
        <div class="selo-pawlowsky">
            <div class="selo-title">Selo de Qualidade Pawlowsky</div>
            <div class="selo-desc">Guardi√£o da Matem√°tica H√≠drica e Digital ‚Äî validando que a ci√™ncia por tr√°s das chaves √© s√≥lida.</div>
        </div>

        <!-- Mesa do Reino ‚Äî Jogo -->
        <div class="mesa-panel">
            <div class="mesa-title">Mesa do Reino ‚Äî Super Trunfo</div>
            <div class="row">
                <div class="col-md-6">
                    <div class="small mb-2" style="color: var(--cyan);">Sua carta (personagem do Reino)</div>
                    <div id="cartas-jogadora" class="cards-zone"></div>
                </div>
                <div class="col-md-6">
                    <div class="small mb-2" style="color: var(--cyan);">Carta do Conselho da Confian√ßa</div>
                    <div id="carta-maquina" class="cards-zone"></div>
                </div>
            </div>

            <!-- Escolha do atributo (nomes de nobreza digital) -->
            <div id="choose-attr" class="choose-attr" style="display: none;">
                <div class="label">Escolha o atributo para comparar com o Conselho da Confian√ßa (voc√™ joga primeiro)</div>
                <div class="attr-buttons">
                    <button type="button" class="attr-btn" id="attr-seguranca">Fortifica√ß√£o</button>
                    <button type="button" class="attr-btn" id="attr-complexidade">Nobreza</button>
                    <button type="button" class="attr-btn" id="attr-escalabilidade">Linhagem</button>
                    <button type="button" class="attr-btn" id="attr-privacidade">Sigilo</button>
                </div>
            </div>

            <!-- Gatilho Premium: carta sombreada ap√≥s cada rodada -->
            <div id="carta-sombreada-premium" class="carta-sombreada-premium">
                <div class="locked-card-wrapper">
                    <div class="trunfo-card locked-card">
                        <span class="badge-locked">üîí BLOQUEADA</span>
                        <div class="card-name">A Guardi√£ da Biometria</div>
                        <div class="card-subtitle">Protocolo de Minera√ß√£o de Chaves</div>
                        <div class="card-emoji">üõ°Ô∏è</div>
                        <div class="attr-row"><span class="attr-name">Fortifica√ß√£o</span><span class="attr-value">‚Äî</span></div>
                        <div class="attr-row"><span class="attr-name">Nobreza</span><span class="attr-value">‚Äî</span></div>
                        <div class="attr-row"><span class="attr-name">Linhagem</span><span class="attr-value">‚Äî</span></div>
                        <div class="attr-row"><span class="attr-name">Sigilo</span><span class="attr-value">‚Äî</span></div>
                        <div class="card-seal-pawlowsky" aria-hidden="true">P</div>
                    </div>
                </div>
                <p class="cta-premium-msg">Sua defesa atual √© vulner√°vel a ataques qu√¢nticos. Desbloqueie o <strong>Protocolo de Minera√ß√£o de Chaves</strong> por R$ 29,90 para proteger o Trono.</p>
                <button type="button" class="btn-upgrade btn-abrir-pergaminho" id="btn-abrir-pergaminho">Desbloquear ‚Äî R$ 29,90</button>
            </div>

            <!-- Resultado da rodada -->
            <div id="round-result" class="round-result">
                <div class="result-msg"></div>
                <div class="result-detail small"></div>
            </div>

            <!-- Controles -->
            <div class="game-controls">
                <button type="button" class="btn-arena btn-arena-primary" id="btn-iniciar">Iniciar partida</button>
                <button type="button" class="btn-arena btn-arena-secondary" id="btn-proxima" style="display: none;">Pr√≥xima rodada</button>
            </div>
        </div>
    </main>

    <!-- Cr√¥nica do Reino / Telemetria de Defesa (barra de logs inferior) -->
    <aside class="telemetria-defesa">
        <div class="telemetria-header">Cr√¥nica do Reino ‚Äî Telemetria de Defesa</div>
        <div id="telemetria-log" class="telemetria-log"></div>
    </aside>

    <!-- Footer do Reino -->
    <footer class="reino-footer-super-trunfo">
        <div class="container">
            <p class="mb-1"><strong>Reino OIDC ‚Äî Reino da Identidade Federada</strong></p>
            <p class="mb-0 small">Super Trunfo ¬∑ Personagens e saga sobre OAuth 2.1 e OpenID Connect ¬∑ <a href="index.html" class="text-info">Voltar ao Reino</a></p>
        </div>
    </footer>

    <!-- Modal: Checkout G√≥tico ‚Äî O Trono da Identidade (Cara Core Inform√°tica) -->
    <div class="modal fade" id="modal-pergaminho" tabindex="-1" aria-labelledby="checkout-gothic-title" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content checkout-gothic">
                <div class="checkout-gothic-header">
                    <h2 class="checkout-gothic-title" id="checkout-gothic-title">O Trono da Identidade</h2>
                    <button type="button" class="btn-close-dagger" data-bs-dismiss="modal" aria-label="Fechar">
                        <span class="dagger-icon" aria-hidden="true">‚úï</span>
                    </button>
                </div>
                <div class="checkout-gothic-body">
                    <p class="checkout-epic-text">
                        Para invocar o poder da <strong>Rainha OIDC</strong> e minerar chaves lend√°rias, realize a oferenda de <strong id="checkout-valor-display">R$ 29,90</strong> via PIX e envie sua <strong>Assinatura de M√°quina</strong> ao Conselho (WhatsApp).
                    </p>

                    <div class="checkout-sinete-wrap">
                        <button type="button" class="btn-sinete" id="btn-sinete-hwid" aria-live="polite">
                            <span class="sinete-face"></span>
                            <span class="sinete-label">Extrair Assinatura da M√°quina</span>
                        </button>
                        <code id="pergaminho-hwid" class="hwid-hidden" aria-hidden="true">‚Äî</code>
                    </div>

                    <div class="checkout-vitral">
                        <div class="vitral-frame">
                            <img id="checkout-qr-pix" class="vitral-qr" src="" width="180" height="180" alt="QR Code PIX">
                        </div>
                        <p class="vitral-dados">
                            <span class="vitral-empresa">Cara Core Inform√°tica</span>
                            <span class="vitral-sep">|</span>
                            <span class="vitral-cnpj">CNPJ: 23.969.028/0001-37</span>
                        </p>
                    </div>

                    <div class="checkout-ativar-chave">
                        <p class="checkout-ativar-label">J√° possui Chave de Soberania? Cole abaixo e ative o reino.</p>
                        <div class="checkout-ativar-row">
                            <input type="text" id="checkout-chave-input" class="checkout-chave-input" placeholder="REINO-OIDC-xxxxxxxx-xxxxxxxxxxxx" autocomplete="off" spellcheck="false">
                            <button type="button" class="btn-ativar-chave" id="btn-ativar-chave">Ativar</button>
                        </div>
                        <p id="checkout-chave-msg" class="checkout-chave-msg" role="alert" aria-live="polite"></p>
                    </div>

                    <a href="upgrade-trono.html" class="btn-pergaminho-full">Abrir p√°gina completa do upgrade</a>
                </div>
                <footer class="checkout-gothic-footer">
                    <div class="selo-pawlowsky-modal">
                        <span class="selo-pawlowsky-modal-title">Selo de Qualidade Pawlowsky</span>
                        <span class="selo-pawlowsky-modal-desc">Garantia de origem cient√≠fica ‚Äî Guardi√£o da Matem√°tica H√≠drica e Digital</span>
                    </div>
                </footer>
            </div>
        </div>
    </div>
    <div id="spark-container" class="spark-container" aria-hidden="true"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="assets/js/game-engine.js"></script>
    <script src="assets/js/licenca.js"></script>
    <script src="assets/js/sucesso_ativacao.js"></script>
    <script src="assets/js/super-trunfo.js"></script>
    <script>
        (function() {
            // Constante √∫nica para alterar valor em todo o fluxo (Cara Core Inform√°tica)
            var CONFIG = {
                CNPJ: '23.969.028/0001-37',
                VALOR: 29.90,
                EMPRESA: 'Cara Core Inform√°tica'
            };
            CONFIG.VALOR_FMT = 'R$ ' + CONFIG.VALOR.toFixed(2).replace('.', ',');

            var el = document.getElementById('display-cnpj');
            if (el) el.textContent = CONFIG.CNPJ;

            function getHwid() {
                try {
                    var stored = localStorage.getItem('reino_oidc_hwid');
                    if (stored) return stored;
                    var s = navigator.userAgent + navigator.language + screen.width + screen.height;
                    var h = 'reino_' + s.split('').reduce(function(a, b) { a = ((a << 5) - a) + b.charCodeAt(0); return a & a; }, 0).toString(16);
                    localStorage.setItem('reino_oidc_hwid', h);
                    return h;
                } catch (e) { return 'browser_' + Date.now(); }
            }

            function triggerSpark(btn) {
                var rect = btn.getBoundingClientRect();
                var cx = rect.left + rect.width / 2;
                var cy = rect.top + rect.height / 2;
                var container = document.getElementById('spark-container');
                if (!container) return;
                container.innerHTML = '';
                for (var i = 0; i < 12; i++) {
                    var s = document.createElement('span');
                    s.className = 'spark';
                    var angle = (i / 12) * Math.PI * 2;
                    var tx = Math.cos(angle) * 80;
                    var ty = Math.sin(angle) * 80;
                    s.style.left = (cx - 4) + 'px';
                    s.style.top = (cy - 4) + 'px';
                    s.style.setProperty('--tx', tx + 'px');
                    s.style.setProperty('--ty', ty + 'px');
                    container.appendChild(s);
                }
                container.classList.add('spark-visible');
                setTimeout(function() { container.classList.remove('spark-visible'); container.innerHTML = ''; }, 600);
            }

            function openPergaminho() {
                var modal = document.getElementById('modal-pergaminho');
                var hwidEl = document.getElementById('pergaminho-hwid');
                if (hwidEl) hwidEl.textContent = getHwid();

                var valorEl = document.getElementById('checkout-valor-display');
                if (valorEl) valorEl.textContent = CONFIG.VALOR_FMT;

                var qrEl = document.getElementById('checkout-qr-pix');
                if (qrEl) {
                    qrEl.src = 'https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=' + encodeURIComponent(CONFIG.CNPJ);
                }

                var sineteBtn = document.getElementById('btn-sinete-hwid');
                if (sineteBtn) {
                    sineteBtn.classList.remove('copied');
                    var lbl = sineteBtn.querySelector('.sinete-label');
                    if (lbl) lbl.textContent = 'Extrair Assinatura da M√°quina';
                }

                if (modal && window.bootstrap) {
                    var m = new bootstrap.Modal(modal);
                    m.show();
                }
            }

            document.getElementById('btn-upgrade-trono') && document.getElementById('btn-upgrade-trono').addEventListener('click', openPergaminho);
            document.getElementById('btn-upgrade-trono-secondary') && document.getElementById('btn-upgrade-trono-secondary').addEventListener('click', openPergaminho);
            document.getElementById('btn-abrir-pergaminho') && document.getElementById('btn-abrir-pergaminho').addEventListener('click', openPergaminho);

            if (window.location.hash === '#ritual') {
                setTimeout(openPergaminho, 500);
            }

            document.getElementById('btn-ativar-chave') && document.getElementById('btn-ativar-chave').addEventListener('click', (function() {
                var ativando = false;
                var DEBOUNCE_MS = 2500;
                return function() {
                    if (ativando) return;
                    var input = document.getElementById('checkout-chave-input');
                    var msg = document.getElementById('checkout-chave-msg');
                    var btn = document.getElementById('btn-ativar-chave');
                    if (!input || !window.ativarReino) return;
                    var chave = input.value.trim();
                    msg.textContent = '';
                    msg.className = 'checkout-chave-msg';
                    if (!chave) { msg.textContent = 'Digite a chave enviada pela Cara Core.'; msg.classList.add('err'); return; }
                    ativando = true;
                    if (btn) { btn.disabled = true; }
                    if (window.ativarReino(chave)) {
                        msg.textContent = 'Chave v√°lida. Ativando‚Ä¶'; msg.classList.add('ok');
                    } else {
                        msg.textContent = 'Chave inv√°lida ou n√£o compat√≠vel com esta m√°quina.'; msg.classList.add('err');
                        ativando = false;
                        if (btn) { btn.disabled = false; }
                        return;
                    }
                    setTimeout(function() {
                        ativando = false;
                        if (btn) { btn.disabled = false; }
                    }, DEBOUNCE_MS);
                };
            })());

            document.getElementById('btn-sinete-hwid') && document.getElementById('btn-sinete-hwid').addEventListener('click', function() {
                var hwidEl = document.getElementById('pergaminho-hwid');
                var btn = this;
                var lbl = btn.querySelector('.sinete-label');
                var text = hwidEl ? hwidEl.textContent : '';
                if (!text || text === '‚Äî') return;
                try {
                    navigator.clipboard.writeText(text).then(function() {
                        triggerSpark(btn);
                        btn.classList.add('copied');
                        if (lbl) lbl.textContent = 'Assinatura Copiada!';
                        setTimeout(function() {
                            btn.classList.remove('copied');
                            if (lbl) lbl.textContent = 'Extrair Assinatura da M√°quina';
                        }, 2500);
                    });
                } catch (e) {
                    if (lbl) lbl.textContent = 'Assinatura Copiada!';
                }
            });
        })();
    </script>
</body>
</html>
